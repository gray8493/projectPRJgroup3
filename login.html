<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Đăng nhập - POS Cafe</title>
  <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
  <div class="center-screen">
    <div class="auth-box card">
      <div class="panel-header">
        <div class="brand">POS Cafe</div>
        <span class="badge">Hệ thống quản lý</span>
      </div>
      <div class="panel-body">
        <!-- Tab Navigation -->
        <div class="auth-tabs">
          <button class="auth-tab active" data-tab="login">Đăng nhập</button>
          <button class="auth-tab" data-tab="register">Đăng ký</button>
        </div>

        <!-- Login Tab -->
        <div id="login-tab" class="auth-tab-content active">
          <div class="grid">
            <div>
              <label class="note">Tài khoản nhân viên</label>
              <input id="username" class="input" placeholder="VD: admin" value="admin">
            </div>
            <div>
              <label class="note">Mật khẩu</label>
              <div style="display:flex; gap:8px; align-items:center;">
                <input id="password" type="password" class="input" placeholder="••••••" value="123456" style="flex:1;">
                <button id="togglePwd" type="button" class="btn" aria-label="Hiện/ẩn mật khẩu">👁</button>
              </div>
            </div>
            <button id="btnLogin" class="btn btn-primary">Đăng nhập Admin</button>
            <div class="note" style="text-align: center; margin-top: 1rem;">
              <a href="menu.html" style="color: var(--color-primary); text-decoration: none;">← Xem menu khách hàng</a>
            </div>
          </div>
        </div>

        <!-- Register Tab -->
        <div id="register-tab" class="auth-tab-content">
          <div class="grid">
            <div>
              <label class="note">Họ và tên</label>
              <input id="regName" class="input" placeholder="Nhập họ và tên">
            </div>
            <div>
              <label class="note">Tài khoản</label>
              <input id="regUsername" class="input" placeholder="Tên đăng nhập">
            </div>
            <div>
              <label class="note">Mật khẩu</label>
              <div style="display:flex; gap:8px; align-items:center;">
                <input id="regPassword" type="password" class="input" placeholder="••••••" style="flex:1;">
                <button id="toggleRegPwd" type="button" class="btn" aria-label="Hiện/ẩn mật khẩu">👁</button>
              </div>
            </div>
            <div>
              <label class="note">Xác nhận mật khẩu</label>
              <input id="regConfirmPassword" type="password" class="input" placeholder="••••••">
            </div>
            <div>
              <label class="note">Số điện thoại</label>
              <input id="regPhone" class="input" placeholder="Số điện thoại">
            </div>
            <button id="btnRegister" class="btn btn-secondary">Đăng ký tài khoản</button>
            <div class="note" style="text-align: center; margin-top: 1rem;">
              <a href="menu.html" style="color: var(--color-primary); text-decoration: none;">← Xem menu khách hàng</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<script>
  // Tab navigation
  function initAuthTabs() {
    const authTabs = document.querySelectorAll('.auth-tab');
    const tabContents = document.querySelectorAll('.auth-tab-content');

    authTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs and contents
        authTabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding content
        tab.classList.add('active');
        const tabId = tab.getAttribute('data-tab');
        const content = document.getElementById(tabId + '-tab');
        if(content) {
          content.classList.add('active');
        }
      });
    });
  }

  // Password toggle functions
  document.getElementById('togglePwd').addEventListener('click', function(){
    const pwd = document.getElementById('password');
    pwd.type = (pwd.type === 'password') ? 'text' : 'password';
  });

  document.getElementById('toggleRegPwd').addEventListener('click', function(){
    const pwd = document.getElementById('regPassword');
    pwd.type = (pwd.type === 'password') ? 'text' : 'password';
  });

  // Login function
  document.getElementById('btnLogin').addEventListener('click', function(){
    const u = document.getElementById('username').value.trim();
    const p = document.getElementById('password').value.trim();
    if(u && p){
      // Check if user exists in localStorage
      const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
      const user = users.find(user => user.username === u && user.password === p);
      
      if(u === 'admin' && p === '123456') {
        // Default admin account
        sessionStorage.setItem('auth', '1');
        sessionStorage.setItem('userRole', 'admin');
        sessionStorage.setItem('userName', 'Admin');
        window.location.href = 'store-selection.html';
      } else if(user) {
        // Registered user
        sessionStorage.setItem('auth', '1');
        sessionStorage.setItem('userRole', 'staff');
        sessionStorage.setItem('userName', user.name);
        window.location.href = 'store-selection.html';
      } else {
        alert('Tài khoản hoặc mật khẩu không đúng!');
      }
    } else {
      alert('Vui lòng nhập đầy đủ thông tin!');
    }
  });

  // Register function
  document.getElementById('btnRegister').addEventListener('click', function(){
    const name = document.getElementById('regName').value.trim();
    const username = document.getElementById('regUsername').value.trim();
    const password = document.getElementById('regPassword').value.trim();
    const confirmPassword = document.getElementById('regConfirmPassword').value.trim();
    const phone = document.getElementById('regPhone').value.trim();

    if(!name || !username || !password || !confirmPassword || !phone) {
      alert('Vui lòng nhập đầy đủ thông tin!');
      return;
    }

    if(password !== confirmPassword) {
      alert('Mật khẩu xác nhận không khớp!');
      return;
    }

    if(password.length < 6) {
      alert('Mật khẩu phải có ít nhất 6 ký tự!');
      return;
    }

    // Check if username already exists
    const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
    if(users.find(user => user.username === username)) {
      alert('Tên đăng nhập đã tồn tại!');
      return;
    }

    // Add new user
    const newUser = {
      name: name,
      username: username,
      password: password,
      phone: phone,
      createdAt: new Date().toISOString()
    };

    users.push(newUser);
    localStorage.setItem('registeredUsers', JSON.stringify(users));

    alert('Đăng ký thành công! Bạn có thể đăng nhập ngay bây giờ.');
    
    // Switch to login tab
    document.querySelector('[data-tab="login"]').click();
    
    // Fill username field
    document.getElementById('username').value = username;
  });

  // Initialize tabs
  initAuthTabs();
</script>
</body>
</html>
